<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>So·∫°n ghi ch√∫ b·∫£o m·∫≠t</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
    font-family:"Times New Roman",serif;
    background:#f2f2f2;
    padding:20px;
}
#login,#editor{
    max-width:900px;
    margin:auto;
    background:#fff;
    padding:20px;
    border-radius:6px;
}
#content{
    border:1px solid #ccc;
    min-height:300px;
    padding:20px;
    margin-top:10px;
}
.doan{
    text-indent:2em;
    text-align:justify;
}
button,select,input{
    margin:4px;
    padding:6px;
}
</style>
</head>

<body>

<!-- ƒêƒÇNG NH·∫¨P -->
<div id="login">
    <h3>üîí Truy c·∫≠p trang so·∫°n th·∫£o</h3>
    <input type="password" id="pass" placeholder="Nh·∫≠p m·∫≠t kh·∫©u">
    <button onclick="login()">ƒêƒÉng nh·∫≠p</button>
</div>

<!-- TR√åNH SO·∫†N -->
<div id="editor" style="display:none">

<h3 style="text-align:center">SO·∫†N GHI CH√ö</h3>
<a class="nav-link" href="index.html">|üè†|</a>
<label>Ti√™u ƒë·ªÅ:</label>
<input id="tieude" style="width:100%"><br>

<label>Ng∆∞·ªùi so·∫°n:</label>
<input id="nguoisoan">

<label>Ng√†y:</label>
<input id="ngay" type="date"><br>

<!-- THANH C√îNG C·ª§ -->
<div>
    <select onchange="exec('fontName',this.value)">
        <option value="Times New Roman">Times New Roman</option>
        <option value="Arial">Arial</option>
        <option value="Tahoma">Tahoma</option>
    </select>

    <select onchange="exec('fontSize',this.value)">
        <option value="3">16</option>
        <option value="4">18</option>
        <option value="5">20</option>
    </select>

    <button onclick="exec('bold')"><b>B</b></button>
    <button onclick="exec('italic')"><i>I</i></button>
    <button onclick="exec('underline')"><u>U</u></button>

    <button onclick="exec('justifyLeft')">‚¨Ö</button>
    <button onclick="exec('justifyCenter')">‚Üî</button>
    <button onclick="exec('justifyRight')">‚û°</button>
    <button onclick="exec('justifyFull')">‚ò∞</button>

    <button onclick="indent()">‚Ü≥ Th·ª•t d√≤ng</button>
</div>

<div id="content" contenteditable="true">
    <p class="doan"> üìñ </p>
</div>

<br>
<button onclick="saveNote()">üíæ L∆∞u</button>
<button onclick="exportPDF()">üìÑ Xu·∫•t PDF</button>
<button onclick="logout()">üîê ƒêƒÉng xu·∫•t</button>
</div>

<script>
/* L∆ØU GHI CH√ö */
function saveNote(){
    const data = {
        tieude: document.getElementById("tieude").value,
        nguoisoan: document.getElementById("nguoisoan").value,
        ngay: document.getElementById("ngay").value,
        noidung: document.getElementById("content").innerHTML
    };
    localStorage.setItem("ghichu_saved", JSON.stringify(data));
    alert("ƒê√£ l∆∞u ghi ch√∫");
}

/* T·∫¢I L·∫†I GHI CH√ö SAU KHI ƒêƒÇNG NH·∫¨P */
function loadNote(){
    const saved = localStorage.getItem("ghichu_saved");
    if(saved){
        const data = JSON.parse(saved);
        document.getElementById("tieude").value = data.tieude || "";
        document.getElementById("nguoisoan").value = data.nguoisoan || "";
        document.getElementById("ngay").value = data.ngay || "";
        document.getElementById("content").innerHTML = data.noidung || "";
    }
}

/* ƒêƒÇNG XU·∫§T */
function logout(){
    document.getElementById("editor").style.display="none";
    document.getElementById("login").style.display="block";
}

/* G·ªåI T·∫¢I SAU KHI ƒêƒÇNG NH·∫¨P */
const oldLogin = login;
login = function(){
    const pw = document.getElementById("pass").value;
    if(pw === "Congkhuyen@"){
        document.getElementById("login").style.display="none";
        document.getElementById("editor").style.display="block";
        loadNote();
    }else{
        alert("Sai m·∫≠t kh·∫©u");
    }
}

function login(){
    const pw = document.getElementById("pass").value;
    if(pw === "123456"){
        document.getElementById("login").style.display="none";
        document.getElementById("editor").style.display="block";
    }else{
        alert("Sai m·∫≠t kh·∫©u");
    }
}

function exec(cmd,val=null){
    document.execCommand(cmd,false,val);
}

function indent(){
    document.execCommand("insertHTML",false,'<p class="doan"></p>');
}

function exportPDF(){

    // ƒê·ªï d·ªØ li·ªáu sang v√πng in
    document.getElementById("p_tieude").innerText =
        document.getElementById("tieude").value;

    document.getElementById("p_nguoisoan").innerText =
        document.getElementById("nguoisoan").value;

    document.getElementById("p_ngay").innerText =
        document.getElementById("ngay").value;

    document.getElementById("p_noidung").innerHTML =
        document.getElementById("content").innerHTML;

    const printDiv = document.getElementById("printArea");
    printDiv.style.display = "block";

    const { jsPDF } = window.jspdf;

    const pdf = new jsPDF("p", "mm", "a4");

    // CƒÉn l·ªÅ (mm)
    const marginTop = 10;
    const marginBottom = 10;
    const marginLeft = 20;
    const marginRight = 10;

    const pageWidth = 210;
    const pageHeight = 297;

    const contentWidth = pageWidth - marginLeft - marginRight;

    html2canvas(printDiv, { scale: 2 }).then(canvas => {

        const img = canvas.toDataURL("image/png");
        const imgHeight = canvas.height * contentWidth / canvas.width;

        let positionY = marginTop;
        let remainingHeight = imgHeight;

        // Trang ƒë·∫ßu
        pdf.addImage(
            img,
            "PNG",
            marginLeft,
            positionY,
            contentWidth,
            imgHeight
        );

        pdf.save("ghichu.pdf");
        printDiv.style.display = "none";
    });
}
</script>

<div id="printArea" style="display:none; padding:20px; font-family:'Times New Roman'; font-size: 14px"> 
    <h3 id="p_tieude" style="text-align:center"></h3>
    <p><b>Ng∆∞·ªùi so·∫°n:</b> <span id="p_nguoisoan"></span> - 
    <b>Ng√†y:</b> <span id="p_ngay"></span></p>
    <hr>
    <div id="p_noidung"></div>
</div>

</body>
</html>

