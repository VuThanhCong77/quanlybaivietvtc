<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="dynamic-title">Chi tiết bài viết</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        body { background-color: #2E8B57; font-family: 'Arial', sans-serif; }
        .main-content { background: white; border-radius: 12px; padding: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .post-img { width: 100%; max-height: 450px; object-fit: cover; border-radius: 12px; margin-bottom: 25px; display: none; }
        .btn-facebook { background-color: #1877F2; color: white; border-radius: 50px; padding: 10px 25px; font-weight: 600; border: none; transition: 0.3s; }
        .btn-facebook:hover { background-color: #145dbf; color: white; }
        #view-content { line-height: 1.8; color: #444; font-size: 1.1rem; }
        #view-content img { max-width: 100%; height: auto; border-radius: 8px; }
    </style>
</head>
<body>

<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="main-content" id="post-container">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="index.html">Trang chủ</a></li>
                        <li class="breadcrumb-item active">Bài viết</li>
                    </ol>
                </nav>

                <h1 id="view-title" class="fw-bold mb-3">Đang tải tiêu đề...</h1>
                
                <div class="text-muted mb-4 small">
                    <i class="fas fa-calendar-alt me-1"></i> <span id="view-date"></span>
                    <span class="ms-3"><i class="fas fa-user me-1"></i> <span id="view-author">Admin</span></span>
                </div>

                <img id="view-image" src="" alt="" class="post-img shadow-sm">

                <div id="view-content" class="mb-5"></div>
<hr class="my-4">

<section id="gop-y" class="mt-4">
    <h5 class="fw-bold mb-3">
        <i class="fas fa-comment-dots me-2"></i>Góp ý bài viết
    </h5>

    <div class="mb-3">
        <input id="gy-ten" class="form-control"
               placeholder="Họ và tên (không bắt buộc)">
    </div>

    <div class="mb-3">
        <textarea id="gy-noidung" class="form-control" rows="4"
                  placeholder="Nội dung góp ý..." required></textarea>
    </div>

    <button class="btn btn-success" onclick="guiGopY()">
        <i class="fas fa-paper-plane me-1"></i>Gửi góp ý
    </button>

    <div id="gy-thongbao" class="mt-3 text-muted small"></div>
</section>

                <hr>
                <div class="d-flex justify-content-between align-items-center mt-4">
                    <button onclick="shareFB()" class="btn-facebook shadow-sm">
                        <i class="fab fa-facebook-f me-2"></i> Facebook
                    </button>
                    <a href="index.html" class="text-decoration-none"><i class="fas fa-arrow-left"></i> Quay lại</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
let currentPost = null;

    async function loadPost() {
        try {
            const urlParams = new URLSearchParams(window.location.search);
            const postId = urlParams.get('id');

            if (!postId) {
                document.getElementById('view-title').innerText = "Vui lòng cung cấp ID bài viết!";
                return;
            }

            const response = await fetch('posts_data.json');
            const data = await response.json();
            
            // Tìm bài viết theo ID
            const post = data.find(p => String(p.id) === String(postId));

            if (post) {
                // Đổ dữ liệu vào giao diện
                document.title = post.title;
                document.getElementById('view-title').innerText = post.title;
                document.getElementById('view-date').innerText = post.date || "Không xác định";
                document.getElementById('view-author').innerText = post.author || "Admin";

                // QUAN TRỌNG: Dùng .description thay vì .content
                document.getElementById('view-content').innerHTML = post.description || "Bài viết này chưa có nội dung.";

                // Hiển thị ảnh dùng .thumbnail
                const imgElement = document.getElementById('view-image');
                if (post.thumbnail) {
                    imgElement.src = post.thumbnail;
                    imgElement.style.display = 'block';
currentPost = post;
                }
            } 
else {
                document.getElementById('post-container').innerHTML = `<h2 class="text-danger text-center">Bài viết không tồn tại!</h2>`;
            }
        } catch (error) {
            console.error("Lỗi:", error);
            document.getElementById('view-content').innerHTML = `
                <div class="alert alert-warning">
                    <b>Lỗi:</b> Không thể đọc file dữ liệu. <br>
                    Hãy đảm bảo bạn đang dùng <b>Live Server</b> và file <b>posts_data.json</b> nằm cùng thư mục.
                </div>`;
        }
    }

    // Hàm chia sẻ Facebook
    function shareFB() {
        const url = window.location.href;
        window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, 'fb-share', 'width=580,height=400');
    }

    document.addEventListener('DOMContentLoaded', loadPost);
function guiGopY() {
    const noiDung = document.getElementById("gy-noidung").value.trim();

    if (!noiDung) {
        document.getElementById("gy-thongbao").innerText =
            "Vui lòng nhập nội dung góp ý.";
        return;
    }

    const data = {
        postId: currentPost?.id || "",
        tieuDe: currentPost?.title || document.title,
        ten: document.getElementById("gy-ten").value,
        noiDung: noiDung,
        thoiGian: new Date().toISOString(),
        url: window.location.href
    };

    fetch("https://script.google.com/macros/s/AKfycbzb_ovIs2kZto3vuHVPATt1Iq0Uvb0GiQo3hvCm_FAcjRgfaTPyjTG0Qir4ECEkyOE8-g/exec", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(data)
    })
    .then(() => {
        document.getElementById("gy-thongbao").innerText =
            "Góp ý đã được gửi. Xin trân trọng cảm ơn!";
        document.getElementById("gy-noidung").value = "";
    })
    .catch(() => {
        document.getElementById("gy-thongbao").innerText =
            "Không gửi được góp ý. Vui lòng thử lại.";
    });
}

</script>

</body>

</html>
