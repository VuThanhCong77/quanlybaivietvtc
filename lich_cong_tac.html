<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Lá»‹ch cÃ´ng tÃ¡c â€“ PhÃ¢n quyá»n</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{ font-family:Segoe UI,Tahoma; background:#f0f2f5; padding:20px; }
.container{ max-width:960px; margin:auto; background:#fff; padding:12px; border-radius:10px; }
.hidden{display:none}
.title-wrap{ display:flex; align-items:center; justify-content:center; gap:12px; margin-bottom:4px; }
.title-wrap img{ height:42px; }
.title-text{ font-size:20px; font-weight:bold; color:#1a73e8; }
button{ padding:8px 16px; border:none; border-radius:6px; color:#fff; cursor:pointer; margin:2px;}
.add{background:#28a745}
.del{background:#dc3545}
.exp{background:#1a73e8}
.imp{background:#6c757d}
.logout{background:#ff9800; float:right}
.login-btn{background:#007bff}
table{ width:100%; border-collapse:collapse; margin-top:10px; }
th,td{ border:1px solid #ddd; padding:8px; text-align:center; }
th{ background:#1a73e8; color:#fff; }
.urgent{ background:#dc3545 !important; color:#fff; font-weight:bold; animation:pulse 1.5s infinite; }
@keyframes pulse{ 0%{opacity:1} 50%{opacity:.7} 100%{opacity:1} }
#adminControls { border:1px dashed #ccc; padding:10px; margin-bottom:10px; border-radius:8px; background:#f9f9f9; }
</style>
</head>

<body>

<div class="container">
    <div class="title-wrap">
        <img src="images/logo.jpg" alt="Logo">
        <div class="title-text">Lá»ŠCH CÃ”NG TÃC</div>
        <img src="images/hoadao.jpg" alt="Icon">
    </div>

    <div id="ngayHienTai" style="text-align:right;color:#b30000;font-weight:bold;margin-bottom:6px"></div>

    <div style="margin-bottom:10px;">
        <a href="index.html">ğŸ Trang chá»§</a> |
        <a href="Lichcongtac/HDlichcongtac.html">ğŸ“˜HÆ°á»›ng dáº«n</a>
        <button id="btnShowLogin" onclick="toggleLoginBox()" class="login-btn" style="float:right">ğŸ” ÄÄƒng nháº­p Quáº£n trá»‹</button>
        <button id="btnLogout" onclick="logout()" class="logout hidden">ğŸšª ÄÄƒng xuáº¥t</button>
    </div>

    <hr>

    <div id="loginBox" class="hidden" style="background:#eee; padding:15px; border-radius:8px; margin-bottom:15px;">
        <b>ÄÄƒng nháº­p dÃ nh cho CÃ¡n bá»™/Quáº£n trá»‹:</b><br><br>
        <select id="role">
            <option value="admin">Quáº£n trá»‹</option>
            <option value="user">CÃ¡n bá»™</option>
        </select>
        <input type="password" id="pass" placeholder="Máº­t kháº©u">
        <button onclick="login()" class="add">XÃ¡c nháº­n</button>
        <button onclick="toggleLoginBox()" style="background:#666">Há»§y</button>
    </div>

    <div id="mainBox">
        <div id="userInfo" style="font-weight:bold; color:#1a73e8; margin-bottom:10px;"></div>

        <div id="adminControls" class="hidden">
            <input id="inpViec" placeholder="Ná»™i dung cÃ´ng viá»‡c" style="width:60%; padding:5px;">
            <input type="datetime-local" id="inpGio" style="padding:5px;">
            <button onclick="themLich()" class="add">â• ThÃªm</button>
            <br><br>
            <button onclick="xuat()" class="exp">ğŸ’¾ Sao lÆ°u</button>
            <button onclick="fileIn.click()" class="imp">ğŸ“‚ Phá»¥c há»“i</button>
            <input type="file" id="fileIn" hidden onchange="nhap(event)">
        </div>

        <table>
            <thead>
                <tr>
                    <th>Thá»i gian</th>
                    <th>Ná»™i dung</th>
                    <th>Tráº¡ng thÃ¡i</th>
                    <th id="colHanhDong" class="hidden">HÃ nh Ä‘á»™ng</th>
                </tr>
            </thead>
            <tbody id="body"></tbody>
        </table>
    </div>
</div>

<audio id="alertSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>

<script>
const USERS = {
    admin: "Cong&khuyen7785",
    user: "Cong&khuyen7785"
};

let role = sessionStorage.getItem("ROLE") || "view";
let data = JSON.parse(localStorage.getItem("LICH_CT")) || [];

function toggleLoginBox(){
    loginBox.classList.toggle("hidden");
}

function login(){
    const r = roleSel.value;
    const p = pass.value;
    if (USERS[r] !== p) return alert("Sai máº­t kháº©u");
    sessionStorage.setItem("ROLE", r);
    location.reload();
}

function logout(){
    if(confirm("ÄÄƒng xuáº¥t khá»i há»‡ thá»‘ng?")){
        sessionStorage.removeItem("ROLE");
        location.reload();
    }
}

function init(){
    userInfo.innerText = "Cháº¿ Ä‘á»™: " + (role === "view" ? "Xem" : role.toUpperCase());

    if(role === "admin" || role === "user"){
        adminControls.classList.remove("hidden");
        colHanhDong.classList.remove("hidden");
        btnLogout.classList.remove("hidden");
        btnShowLogin.classList.add("hidden");
    }
    if(role === "user"){
        document.querySelector(".imp").style.display = "none";
    }
    render();
}

function render(){
    body.innerHTML = "";
    const now = new Date();
    let coCanhBao = false;

    data.sort((a,b)=> new Date(a.g)-new Date(b.g));

    data.forEach(i=>{
        const tg = new Date(i.g);
        const diff = (tg-now)/3600000;
        let trangThai="Äang chá»", cls="";

        if(diff<0) trangThai="ÄÃ£ qua";
        else if(diff<=6){ trangThai="âš ï¸ Sáº¯p diá»…n ra"; cls="urgent"; coCanhBao=true; }

        let row = `<tr class="${cls}">
            <td>${tg.toLocaleString("vi-VN")}</td>
            <td>${i.v}</td>
            <td>${trangThai}</td>`;

        if(role==="admin"){
            row+=`<td>
                <button class="exp" onclick="sua(${i.id})">âœï¸ Sá»­a</button>
                <button class="del" onclick="xoa(${i.id})">XÃ³a</button>
            </td>`;
        }else if(role==="user"){
            row+=`<td>-</td>`;
        }
        row+="</tr>";
        body.innerHTML+=row;
    });

    if(coCanhBao && role!=="view"){
        alertSound.play().catch(()=>{});
    }
    localStorage.setItem("LICH_CT",JSON.stringify(data));
}

function themLich(){
    if(!inpViec.value||!inpGio.value) return alert("Thiáº¿u thÃ´ng tin");
    data.push({id:Date.now(),v:inpViec.value,g:inpGio.value});
    inpViec.value=""; inpGio.value="";
    render();
}

function sua(id){
    const item = data.find(i=>i.id===id);
    if(!item) return;

    const v = prompt("Sá»­a ná»™i dung:", item.v);
    if(v===null) return;

    const g = prompt("Sá»­a thá»i gian (YYYY-MM-DDTHH:MM):", item.g);
    if(g===null) return;

    item.v = v.trim();
    item.g = g;
    render();
}

function xoa(id){
    if(confirm("XÃ³a lá»‹ch nÃ y?")){
        data=data.filter(i=>i.id!==id);
        render();
    }
}

function xuat(){
    const a=document.createElement("a");
    a.href=URL.createObjectURL(new Blob([JSON.stringify(data,null,2)]));
    a.download="backup_lich.json";
    a.click();
}

function nhap(e){
    const r=new FileReader();
    r.onload=ev=>{
        data=JSON.parse(ev.target.result);
        render();
        alert("Phá»¥c há»“i thÃ nh cÃ´ng");
    };
    r.readAsText(e.target.files[0]);
}

function hienNgayDayDu(){
    return new Date().toLocaleDateString("vi-VN",{weekday:"long",year:"numeric",month:"long",day:"numeric"});
}

ngayHienTai.innerText=hienNgayDayDu();
init();
setInterval(render,60000);
</script>

</body>
</html>
