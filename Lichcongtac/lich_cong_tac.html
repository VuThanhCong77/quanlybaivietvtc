<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>L·ªãch c√¥ng t√°c ‚Äì Ph√¢n quy·ªÅn</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* CSS GI·ªÆ NGUY√äN NH∆Ø B·∫¢N C·ª¶A B·∫†N */
body{ font-family:Segoe UI,Tahoma; background:#f0f2f5; padding:20px; }
.container{ max-width:960px; margin:auto; background:#fff; padding:12px; border-radius:10px; }
.hidden{display:none}
.title-wrap{ display:flex; align-items:center; justify-content:center; gap:12px; margin-bottom:4px; }
.title-wrap img{ height:42px; }
.title-text{ font-size:20px; font-weight:bold; color:#1a73e8; }
button{ padding:8px 16px; border:none; border-radius:6px; color:#fff; cursor:pointer; margin: 2px;}
.add{background:#28a745}
.del{background:#dc3545}
.exp{background:#1a73e8}
.imp{background:#6c757d}
.logout{background:#ff9800; float:right}
.login-btn{background:#007bff}
table{ width:100%; border-collapse:collapse; margin-top:10px; }
th,td{ border:1px solid #ddd; padding:8px; text-align:center; }
th{ background:#1a73e8; color:#fff; }
.urgent{ background:#dc3545 !important; color:#fff; font-weight:bold; animation:pulse 1.5s infinite; }
@keyframes pulse{ 0%{opacity:1} 50%{opacity:.7} 100%{opacity:1} }
#adminControls { border: 1px dashed #ccc; padding: 10px; margin-bottom: 10px; border-radius: 8px; background: #f9f9f9; }
</style>
</head>

<body>

<div class="container">
    <div class="title-wrap">
        <img src="logo.png" alt="Logo">
        <div class="title-text">L·ªäCH C√îNG T√ÅC</div>
        <img src="hoadao.png" alt="Icon">
    </div>

    <div id="ngayHienTai" style="text-align:right;color:#b30000;font-weight:bold;margin-bottom:6px"></div>

    <div style="margin-bottom: 10px;">
        <a href="../index.html">üå∏ Trang ch·ªß</a> |
        <a href="../Lichcongtac/HDlichcongtac.html">üå∏ H∆∞·ªõng d·∫´n</a>
        <button id="btnShowLogin" onclick="toggleLoginBox()" class="login-btn" style="float:right">üîê ƒêƒÉng nh·∫≠p Qu·∫£n tr·ªã</button>
        <button id="btnLogout" onclick="logout()" class="logout hidden">üö™ ƒêƒÉng xu·∫•t</button>
    </div>

    <hr>

    <div id="loginBox" class="hidden" style="background:#eee; padding:15px; border-radius:8px; margin-bottom:15px;">
        <b>ƒêƒÉng nh·∫≠p d√†nh cho C√°n b·ªô/Qu·∫£n tr·ªã:</b><br><br>
        <select id="role">
            <option value="admin">Qu·∫£n tr·ªã</option>
            <option value="user">C√°n b·ªô</option>
        </select>
        <input type="password" id="pass" placeholder="M·∫≠t kh·∫©u">
        <button onclick="login()" class="add">X√°c nh·∫≠n</button>
        <button onclick="toggleLoginBox()" style="background:#666">H·ªßy</button>
    </div>

    <div id="mainBox">
        <div id="userInfo" style="font-weight:bold; color:#1a73e8; margin-bottom:10px;"></div>

        <div id="adminControls" class="hidden">
            <input id="inpViec" placeholder="N·ªôi dung c√¥ng vi·ªác" style="width:60%; padding:5px;">
            <input type="datetime-local" id="inpGio" style="padding:5px;">
            <button id="btnAdd" onclick="themLich()" class="add">‚ûï Th√™m</button>
            <br><br>
            <button id="btnExport" onclick="xuat()" class="exp">üíæ Sao l∆∞u</button>
            <button id="btnImport" onclick="fileIn.click()" class="imp">üìÇ Ph·ª•c h·ªìi</button>
            <input type="file" id="fileIn" hidden onchange="nhap(event)">
        </div>

        <table>
            <thead>
                <tr>
                    <th>Th·ªùi gian</th>
                    <th>N·ªôi dung</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th id="colHanhDong" class="hidden">H√†nh ƒë·ªông</th>
                </tr>
            </thead>
            <tbody id="body"></tbody>
        </table>
    </div>
</div>

<audio id="alertSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>

<script>
const USERS = {
    admin: "Cong&khuyen7785",
    user: "Cong&khuyen7785"
};

// M·∫∑c ƒë·ªãnh l√† 'view' n·∫øu ch∆∞a c√≥ phi√™n ƒëƒÉng nh·∫≠p
let role = sessionStorage.getItem("ROLE") || "view"; 
let data = JSON.parse(localStorage.getItem("LICH_CT")) || [];

function toggleLoginBox() {
    const box = document.getElementById("loginBox");
    box.classList.toggle("hidden");
}

function login() {
    const r = document.getElementById("role").value;
    const p = document.getElementById("pass").value;
    if (USERS[r] !== p) return alert("Sai m·∫≠t kh·∫©u");
    sessionStorage.setItem("ROLE", r);
    location.reload();
}

function logout() {
    if (confirm("ƒêƒÉng xu·∫•t kh·ªèi h·ªá th·ªëng?")) {
        sessionStorage.removeItem("ROLE");
        location.reload();
    }
}

function init() {
    userInfo.innerText = "Ch·∫ø ƒë·ªô: " + (role === "view" ? "Ng∆∞·ªùi xem" : role.toUpperCase());

    // N·∫øu l√† admin ho·∫∑c user, hi·ªán v√πng ƒëi·ªÅu khi·ªÉn
    if (role === "admin" || role === "user") {
        document.getElementById("adminControls").classList.remove("hidden");
        document.getElementById("colHanhDong").classList.remove("hidden");
        document.getElementById("btnLogout").classList.remove("hidden");
        document.getElementById("btnShowLogin").classList.add("hidden");
    }
    
    // User kh√¥ng ƒë∆∞·ª£c ph·ª•c h·ªìi file
    if (role === "user") {
        document.getElementById("btnImport").style.display = "none";
    }

    render();
}

function render() {
    body.innerHTML = "";
    const now = new Date();
    let coCanhBao = false;

    data.sort((a, b) => new Date(a.g) - new Date(b.g));

    data.forEach(i => {
        const tg = new Date(i.g);
        const diff = (tg - now) / 3600000;
        let trangThai = "ƒêang ch·ªù";
        let cls = "";

        if (diff < 0) {
            trangThai = "ƒê√£ qua";
        } else if (diff <= 6) {
            trangThai = "‚ö†Ô∏è S·∫Øp di·ªÖn ra";
            cls = "urgent";
            coCanhBao = true;
        }

        let htmlRow = `<tr class="${cls}">
            <td>${tg.toLocaleString("vi-VN")}</td>
            <td>${i.v}</td>
            <td>${trangThai}</td>`;
        
        // Ch·ªâ hi·ªán n√∫t X√≥a cho Qu·∫£n tr·ªã
        if (role === "admin") {
            htmlRow += `<td><button class="del" onclick="xoa(${i.id})">X√≥a</button></td>`;
        } else if (role === "user") {
            htmlRow += `<td>-</td>`;
        }

        htmlRow += `</tr>`;
        body.innerHTML += htmlRow;
    });

    if (coCanhBao && role !== "view") {
        document.getElementById("alertSound").play().catch(() => {});
    }
    localStorage.setItem("LICH_CT", JSON.stringify(data));
}

function themLich() {
    if (!inpViec.value || !inpGio.value) return alert("Thi·∫øu th√¥ng tin");
    data.push({ id: Date.now(), v: inpViec.value, g: inpGio.value });
    inpViec.value = ""; inpGio.value = "";
    render();
}

function xoa(id) {
    if (confirm("X√≥a l·ªãch n√†y?")) {
        data = data.filter(i => i.id !== id);
        render();
    }
}

function xuat() {
    const a = document.createElement("a");
    a.href = URL.createObjectURL(new Blob([JSON.stringify(data, null, 2)]));
    a.download = "backup_lich.json";
    a.click();
}

function nhap(e) {
    const r = new FileReader();
    r.onload = ev => {
        data = JSON.parse(ev.target.result);
        render();
        alert("Ph·ª•c h·ªìi th√†nh c√¥ng");
    };
    r.readAsText(e.target.files[0]);
}

function hienNgayDayDu() {
    const d = new Date();
    return d.toLocaleDateString("vi-VN", { weekday: "long", year: 'numeric', month: 'long', day: 'numeric' });
}

document.getElementById("ngayHienTai").innerText = hienNgayDayDu();
init();
setInterval(render, 60000);
</script>

</body>

</html>


