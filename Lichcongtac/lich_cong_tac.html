<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>H·ªá th·ªëng L·ªãch t√¥ng t√°c</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f4f7f6; padding: 20px; color: #333; }
        .container { max-width: 900px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        h2 { color: #1a73e8; text-align: center; }
        
        .form-box { background: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 20px; }
        .input-row { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        input { padding: 12px; border: 1px solid #ccc; border-radius: 5px; flex: 1; min-width: 200px; font-size: 16px; }
        
        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; }
        button { padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.3s; color: white; }
        .btn-add { background: #28a745; flex: 2; }
        .btn-add:hover { background: #218838; }
        .btn-export { background: #007bff; flex: 1; }
        .btn-import { background: #6c757d; flex: 1; }
        .btn-del { background: #dc3545; padding: 5px 10px; font-size: 12px; }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #eee; padding: 12px; text-align: left; }
        th { background: #1a73e8; color: white; }
        .urgent { color: red; font-weight: bold; animation: blink 1s infinite; background: #fff0f0; }
        @keyframes blink { 50% { opacity: 0.3; } }
    </style>
</head>
<body>

<div class="container">
    <h2>üìÖ QU·∫¢N L√ù L·ªäCH C√îNG T√ÅC</h2>
    <a href="../Lichcongtac/HDlichcongtac.html">üå∏ H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</a>
    
    <div class="form-box">
        <div class="input-row">
            <input type="text" id="inpViec" placeholder="N·ªôi dung c√¥ng vi·ªác (v√≠ d·ª•: H·ªçp ƒê·∫£ng ·ªßy)...">
            <input type="datetime-local" id="inpGio">
        </div>
        <div class="btn-group">
            <button class="btn-add" onclick="xuLyThem()">‚ûï TH√äM L·ªäCH M·ªöI</button>
            <button class="btn-export" onclick="xuLyXuat()">üíæ SAO L∆ØU (FILE)</button>
            <button class="btn-import" onclick="document.getElementById('fileDauVao').click()">üìÇ PH·ª§C H·ªíI</button>
            <input type="file" id="fileDauVao" style="display:none" onchange="xuLyNhap(event)">
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>Th·ªùi Gian</th>
                <th>C√¥ng Vi·ªác</th>
                <th>Tr·∫°ng Th√°i (Nh·∫Øc 6h)</th>
                <th>X√≥a</th>
            </tr>
        </thead>
        <tbody id="danhSachLich"></tbody>
    </table>
</div>

<audio id="chuongBao" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
    // 1. Kh·ªüi t·∫°o d·ªØ li·ªáu (L·∫•y t·ª´ b·ªô nh·ªõ m√°y ho·∫∑c d√πng m·∫∑c ƒë·ªãnh)
    let dsLich = JSON.parse(localStorage.getItem('LICH_APP_2025')) || [];

    // 2. H√†m Th√™m L·ªãch (ƒê√£ s·ª≠a l·ªói kh√¥ng nh·∫•n ƒë∆∞·ª£c)
    function xuLyThem() {
        const viec = document.getElementById('inpViec').value.trim();
        const gio = document.getElementById('inpGio').value;

        if (!viec || !gio) {
            alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß: 1. N·ªôi dung c√¥ng vi·ªác v√† 2. Ng√†y gi·ªù c·ª• th·ªÉ!");
            return;
        }

        const mucMoi = { id: Date.now(), v: viec, g: gio };
        dsLich.push(mucMoi);
        
        // X√≥a tr·∫Øng √¥ nh·∫≠p sau khi th√™m th√†nh c√¥ng
        document.getElementById('inpViec').value = "";
        document.getElementById('inpGio').value = "";
        
        luuVaHienThi();
    }

    // 3. H√†m X√≥a L·ªãch
    function xuLyXoa(id) {
        if(confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a l·ªãch n√†y kh√¥ng?")) {
            dsLich = dsLich.filter(item => item.id !== id);
            luuVaHienThi();
        }
    }

    // 4. H√†m Sao L∆∞u (Xu·∫•t file .json)
    function xuLyXuat() {
        if(dsLich.length === 0) return alert("Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ sao l∆∞u!");
        const dataStr = JSON.stringify(dsLich, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'du_phong_lich_cong_tac.json';
        link.click();
    }

    // 5. H√†m Ph·ª•c H·ªìi (Nh·∫≠p file)
    function xuLyNhap(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                if (Array.isArray(data)) {
                    dsLich = data;
                    luuVaHienThi();
                    alert("ƒê√£ ph·ª•c h·ªìi d·ªØ li·ªáu th√†nh c√¥ng!");
                }
            } catch (err) { alert("File kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng d·ª± ph√≤ng!"); }
        };
        reader.readAsText(file);
    }

    // 6. L∆∞u v√†o b·ªô nh·ªõ v√† v·∫Ω l·∫°i b·∫£ng
    function luuVaHienThi() {
        localStorage.setItem('LICH_APP_2025', JSON.stringify(dsLich));
        
        const tbody = document.getElementById('danhSachLich');
        tbody.innerHTML = '';
        const bayGio = new Date();

        // S·∫Øp x·∫øp theo th·ªùi gian
        dsLich.sort((a, b) => new Date(a.g) - new Date(b.g));

        dsLich.forEach(item => {
            const thoiDiem = new Date(item.g);
            const diffHours = (thoiDiem - bayGio) / (1000 * 60 * 60);
            
            let trangThai = "ƒêang ch·ªù";
            let lopCSS = "";

            if (diffHours < 0) {
                trangThai = "ƒê√£ qua";
            } else if (diffHours <= 6) {
                trangThai = "‚ö†Ô∏è NH·∫ÆC (D∆∞·ªõi 6h)";
                lopCSS = "urgent";
                document.getElementById('chuongBao').play().catch(()=>{});
            }

            tbody.innerHTML += `
                <tr>
                    <td><b>${thoiDiem.toLocaleString('vi-VN')}</b></td>
                    <td>${item.v}</td>
                    <td class="${lopCSS}">${trangThai}</td>
                    <td><button class="btn-del" onclick="xuLyXoa(${item.id})">X√≥a</button></td>
                </tr>
            `;
        });
    }

    // Ch·∫°y c·∫≠p nh·∫≠t t·ª± ƒë·ªông m·ªói ph√∫t
    setInterval(luuVaHienThi, 60000);
    luuVaHienThi();
</script>

</body>
</html>