<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>L·ªãch c√¥ng t√°c</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #e9ecef; padding: 20px; }
        .container { max-width: 900px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        h2 { color: #0d6efd; text-align: center; }
        .form-group, .backup-group { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; gap: 10px; align-items: center; }
        input[type="text"], input[type="datetime-local"] { padding: 10px; border: 1px solid #ddd; border-radius: 5px; flex: 1; }
        button { padding: 10px 15px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; }
        .btn-add { background: #198754; color: white; }
        .btn-export { background: #0dcaf0; color: white; }
        .btn-import { background: #6c757d; color: white; }
        .btn-delete { background: #dc3545; color: white; padding: 5px; font-size: 12px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #dee2e6; padding: 12px; text-align: left; }
        th { background-color: #0d6efd; color: white; }
        .status-alert { color: #d93025; font-weight: bold; animation: blink 1s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
    </style>
</head>
<body>
<header class="site-header">
  <container>
    <nav>
      <a href="../Lichcongtac/HDlichcongtac.html">üå∏ H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</a>
       </div>
    </nav>
  </container>
</header>

<div class="container">
    <h2>üìÖ L·ªãch c√¥ng t√°c üå∏ V≈© Th√†nh C√¥ng</h2>
    
    <div class="form-group">
        <input type="text" id="eventTitle" placeholder="N·ªôi dung c√¥ng vi·ªác...">
        <input type="datetime-local" id="eventTime">
        <button class="btn-add" onclick="addEvent()">‚ûï Th√™m L·ªãch</button>
    </div>

    <div class="backup-group">
        <span>B·∫£o v·ªá d·ªØ li·ªáu:</span>
        <button class="btn-export" onclick="exportData()">üíæ Xu·∫•t file d·ª± ph√≤ng</button>
        <input type="file" id="importFile" style="display:none" onchange="importData(event)">
        <button class="btn-import" onclick="document.getElementById('importFile').click()">üìÇ Ph·ª•c h·ªìi t·ª´ file</button>
    </div>

    <div id="status-summary" style="text-align: center; margin-bottom: 15px;"></div>

    <table>
        <thead>
            <tr>
                <th>Th·ªùi gian</th>
                <th>S·ª± ki·ªán</th>
                <th>Tr·∫°ng th√°i</th>
                <th>Thao t√°c</th>
            </tr>
        </thead>
        <tbody id="event-table"></tbody>
    </table>
</div>

<audio id="alarmSound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
    // Kh·ªüi t·∫°o d·ªØ li·ªáu t·ª´ PDF ho·∫∑c t·ª´ b·ªô nh·ªõ [cite: 1, 10, 24, 38]
    let events = JSON.parse(localStorage.getItem('mySchedule_2025')) || [
        { title: "Giao ban Th∆∞·ªùng tr·ª±c ƒê·∫£ng ·ªßy", time: "2025-10-06T08:00" }, [cite: 21]
        { title: "ƒê·∫°i h·ªôi MTTQ", time: "2025-10-14T07:30" }, [cite: 21]
        { title: "T·ªïng k·∫øt c√¥ng t√°c ki·ªÉm tra", time: "2025-11-24T08:00" } [cite: 35]
    ];

    function addEvent() {
        const title = document.getElementById('eventTitle').value;
        const time = document.getElementById('eventTime').value;
        if (!title || !time) return alert("Vui l√≤ng nh·∫≠p ƒë·ªß th√¥ng tin!");
        events.push({ title, time });
        saveAndRefresh();
        document.getElementById('eventTitle').value = '';
    }

    // CH·ª®C NƒÇNG XU·∫§T FILE (D·ª∞ PH√íNG)
    function exportData() {
        const dataStr = JSON.stringify(events, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
        const exportFileDefaultName = 'du_phong_lich_2025.json';

        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        linkElement.click();
    }

    // CH·ª®C NƒÇNG NH·∫¨P FILE (PH·ª§C H·ªíI)
    function importData(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const importedEvents = JSON.parse(e.target.result);
                if (Array.isArray(importedEvents)) {
                    events = importedEvents;
                    saveAndRefresh();
                    alert("ƒê√£ ph·ª•c h·ªìi d·ªØ li·ªáu th√†nh c√¥ng!");
                }
            } catch (err) {
                alert("File kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng!");
            }
        };
        reader.readAsText(file);
    }

    function deleteEvent(index) {
        if(confirm("X√≥a l·ªãch n√†y?")) {
            events.splice(index, 1);
            saveAndRefresh();
        }
    }

    function saveAndRefresh() {
        localStorage.setItem('mySchedule_2025', JSON.stringify(events));
        renderTable();
    }

    function renderTable() {
        const tableBody = document.getElementById('event-table');
        const now = new Date();
        tableBody.innerHTML = '';
        let alertCount = 0;

        events.sort((a, b) => new Date(a.time) - new Date(b.time));

        events.forEach((ev, index) => {
            const eventDate = new Date(ev.time);
            const diffHours = (eventDate - now) / (1000 * 60 * 60);
            let status = diffHours < 0 ? "ƒê√£ qua" : "ƒêang ch·ªù";
            let statusClass = "";

            if (diffHours > 0 && diffHours <= 6) {
                status = "‚ö†Ô∏è NH·∫ÆC (D∆∞·ªõi 6h)";
                statusClass = "status-alert";
                alertCount++;
                document.getElementById('alarmSound').play().catch(() => {});
            }

            tableBody.innerHTML += `
                <tr>
                    <td>${eventDate.toLocaleString('vi-VN')}</td>
                    <td>${ev.title}</td>
                    <td class="${statusClass}">${status}</td>
                    <td><button class="btn-delete" onclick="deleteEvent(${index})">X√≥a</button></td>
                </tr>`;
        });
        document.getElementById('status-summary').innerHTML = `S·ªë l·ªãch s·∫Øp t·ªõi c·∫ßn nh·∫Øc: <b>${alertCount}</b>`;
    }

    setInterval(renderTable, 60000);
    renderTable();
</script>

</body>
</html>