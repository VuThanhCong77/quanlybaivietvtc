<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Lá»‹ch cÃ´ng tÃ¡c â€“ PhÃ¢n quyá»n</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { font-family: Segoe UI, Tahoma; background:#f0f2f5; padding:20px; }
.container { max-width:960px; margin:auto; background:#fff; padding:15px; border-radius:10px; }
h2 { text-align:center; color:#1a73e8; margin-top:0; }
.hidden { display:none; }
button { padding:8px 14px; border:none; border-radius:6px; color:#fff; cursor:pointer; }
.add { background:#28a745; }
.del { background:#dc3545; }
.exp { background:#1a73e8; }
.imp { background:#6c757d; }
table { width:100%; border-collapse:collapse; margin-top:10px; }
th,td { border:1px solid #ddd; padding:8px; text-align:center; }
th { background:#1a73e8; color:#fff; }
</style>
</head>

<body>

<div class="container">

<h2>ğŸ“… Lá»ŠCH CÃ”NG TÃC</h2>

<!-- ÄÄ‚NG NHáº¬P -->
<div id="loginBox">
    <b>ÄÄƒng nháº­p:</b><br><br>
    <select id="role">
        <option value="">-- Chá»n vai trÃ² --</option>
        <option value="admin">Quáº£n trá»‹</option>
        <option value="user">CÃ¡n bá»™</option>
        <option value="view">Xem</option>
    </select>
    <input type="password" id="pass" placeholder="Máº­t kháº©u">
    <button onclick="login()" class="add">ÄÄƒng nháº­p</button>
</div>

<!-- Há»† THá»NG -->
<div id="mainBox" class="hidden">

<div id="userInfo" style="margin-bottom:10px;font-weight:bold"></div>

<input id="inpViec" placeholder="Ná»™i dung cÃ´ng viá»‡c">
<input type="datetime-local" id="inpGio">

<br><br>

<button id="btnAdd" onclick="themLich()" class="add">â• ThÃªm</button>
<button id="btnExport" onclick="xuat()" class="exp">ğŸ’¾ Sao lÆ°u</button>
<button id="btnImport" onclick="fileIn.click()" class="imp">ğŸ“‚ Phá»¥c há»“i</button>
<input type="file" id="fileIn" hidden onchange="nhap(event)">

<table>
<thead>
<tr>
<th>Thá»i gian</th>
<th>Ná»™i dung</th>
<th>HÃ nh Ä‘á»™ng</th>
</tr>
</thead>
<tbody id="body"></tbody>
</table>

</div>
</div>

<script>
// ===== TÃ€I KHOáº¢N =====
const USERS = {
    admin: "123456",
    user: "123456",
    view: "123456"
};

let role = sessionStorage.getItem("ROLE");
let data = JSON.parse(localStorage.getItem("LICH_CT")) || [];

// ===== ÄÄ‚NG NHáº¬P =====
function login(){
    const r = roleSelect.value = document.getElementById("role").value;
    const p = document.getElementById("pass").value;
    if(USERS[r] !== p) return alert("Sai thÃ´ng tin!");
    sessionStorage.setItem("ROLE", r);
    role = r;
    init();
}

// ===== KHá»I Táº O =====
function init(){
    loginBox.classList.add("hidden");
    mainBox.classList.remove("hidden");
    userInfo.innerText = "Quyá»n Ä‘ang sá»­ dá»¥ng: " + role.toUpperCase();

    if(role === "view"){
        btnAdd.disabled = true;
        btnExport.disabled = true;
        btnImport.disabled = true;
        inpViec.disabled = true;
        inpGio.disabled = true;
    }

    if(role === "user"){
        btnImport.disabled = true;
    }

    render();
}

if(role) init();

// ===== RENDER =====
function render(){
    body.innerHTML = "";
    data.forEach(i=>{
        body.innerHTML += `
        <tr>
            <td>${new Date(i.g).toLocaleString("vi-VN")}</td>
            <td>${i.v}</td>
            <td>${role==="admin"?`<button class="del" onclick="xoa(${i.id})">XÃ³a</button>`:""}</td>
        </tr>`;
    });
    localStorage.setItem("LICH_CT", JSON.stringify(data));
}

// ===== NGHIá»†P Vá»¤ =====
function themLich(){
    if(!inpViec.value || !inpGio.value) return alert("Thiáº¿u thÃ´ng tin");
    data.push({id:Date.now(), v:inpViec.value, g:inpGio.value});
    inpViec.value=""; inpGio.value="";
    render();
}

function xoa(id){
    if(confirm("XÃ³a?")){
        data = data.filter(i=>i.id!==id);
        render();
    }
}

function xuat(){
    const a=document.createElement("a");
    a.href=URL.createObjectURL(new Blob([JSON.stringify(data)]));
    a.download="backup.json";
    a.click();
}

function nhap(e){
    const r=new FileReader();
    r.onload=ev=>{
        data=JSON.parse(ev.target.result);
        render();
        alert("ÄÃ£ phá»¥c há»“i");
    };
    r.readAsText(e.target.files[0]);
}
</script>

</body>
</html>
