<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Lá»‹ch cÃ´ng tÃ¡c â€“ PhÃ¢n quyá»n</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    font-family:Segoe UI,Tahoma;
    background:#f0f2f5;
    padding:20px;
}
.container{
    max-width:960px;
    margin:auto;
    background:#fff;
    padding:12px;
    border-radius:10px;
}
.hidden{display:none}

/* ===== TIÃŠU Äá»€ ===== */
.title-wrap{
    display:flex;
    align-items:center;
    justify-content:center;
    gap:12px;
    margin-bottom:4px;
}
.title-wrap img{
    height:42px;
}
.title-text{
    font-size:26px;
    font-weight:bold;
    color:#1a73e8;
}

/* ===== BUTTON ===== */
button{
    padding:8px 16px;
    border:none;
    border-radius:6px;
    color:#fff;
    cursor:pointer;
}
.add{background:#28a745}
.del{background:#dc3545}
.exp{background:#1a73e8}
.imp{background:#6c757d}
.logout{background:#ff9800;float:right}

/* ===== TABLE ===== */
table{
    width:100%;
    border-collapse:collapse;
    margin-top:10px;
}
th,td{
    border:1px solid #ddd;
    padding:8px;
    text-align:center;
}
th{
    background:#1a73e8;
    color:#fff;
}

/* ===== Cáº¢NH BÃO ===== */
.urgent{
    background:#dc3545 !important;
    color:#fff;
    font-weight:bold;
    animation:pulse 1.5s infinite;
}
@keyframes pulse{
    0%{opacity:1}
    50%{opacity:.7}
    100%{opacity:1}
}
</style>
</head>

<body>

<div class="container">

<!-- ===== TIÃŠU Äá»€ ===== -->
<div class="title-wrap">
    <img src="images/logo.png" alt="Hoa mai">
    <div class="title-text">ğŸ“… Lá»ŠCH CÃ”NG TÃC</div>
    <img src="images\hoadao.png"" alt="Hoa Ä‘Ã o">
</div>

<div id="ngayHienTai"
     style="text-align:right;color:#b30000;font-weight:bold;margin-bottom:6px">
</div>

<a href="../index.html">ğŸŒ¸ Trang chá»§</a> |
<a href="../Lichcongtac/HDlichcongtac.html">ğŸŒ¸ HÆ°á»›ng dáº«n sá»­ dá»¥ng</a>

<hr>

<!-- ===== ÄÄ‚NG NHáº¬P ===== -->
<div id="loginBox">
    <b>ÄÄƒng nháº­p:</b><br><br>
    <select id="role">
        <option value="">-- Chá»n vai trÃ² --</option>
        <option value="admin">Quáº£n trá»‹</option>
        <option value="user">CÃ¡n bá»™</option>
        <option value="view">Xem</option>
    </select>
    <input type="password" id="pass" placeholder="Máº­t kháº©u">
    <button onclick="login()" class="add">ÄÄƒng nháº­p</button>
</div>

<!-- ===== Há»† THá»NG ===== -->
<div id="mainBox" class="hidden">

<div style="overflow:hidden;margin-bottom:10px">
    <div id="userInfo" style="font-weight:bold;float:left"></div>
    <button onclick="logout()" class="logout">ğŸšª ÄÄƒng xuáº¥t</button>
</div>

<input id="inpViec" placeholder="Ná»™i dung cÃ´ng viá»‡c">
<input type="datetime-local" id="inpGio">

<br><br>

<button id="btnAdd" onclick="themLich()" class="add">â• ThÃªm</button>
<button id="btnExport" onclick="xuat()" class="exp">ğŸ’¾ Sao lÆ°u</button>
<button id="btnImport" onclick="fileIn.click()" class="imp">ğŸ“‚ Phá»¥c há»“i</button>
<input type="file" id="fileIn" hidden onchange="nhap(event)">

<table>
<thead>
<tr>
    <th>Thá»i gian</th>
    <th>Ná»™i dung</th>
    <th>Tráº¡ng thÃ¡i</th>
    <th>HÃ nh Ä‘á»™ng</th>
</tr>
</thead>
<tbody id="body"></tbody>
</table>

</div>
</div>

<audio id="alertSound"
src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3">
</audio>

<script>
/* ===== TÃ€I KHOáº¢N ===== */
const USERS={
    admin:"Cong&khuyen7785",
    user:"Cong&khuyen7785",
    view:"123456"
};

let role=sessionStorage.getItem("ROLE");
let data=JSON.parse(localStorage.getItem("LICH_CT"))||[];

/* ===== ÄÄ‚NG NHáº¬P ===== */
function login(){
    const r=document.getElementById("role").value;
    const p=document.getElementById("pass").value;
    if(!r||!p) return alert("Vui lÃ²ng nháº­p Ä‘á»§ thÃ´ng tin");
    if(USERS[r]!==p) return alert("Sai máº­t kháº©u");
    sessionStorage.setItem("ROLE",r);
    role=r;
    init();
}

/* ===== ÄÄ‚NG XUáº¤T ===== */
function logout(){
    if(confirm("ÄÄƒng xuáº¥t khá»i há»‡ thá»‘ng?")){
        sessionStorage.removeItem("ROLE");
        location.reload();
    }
}

/* ===== KHá»I Táº O ===== */
function init(){
    loginBox.classList.add("hidden");
    mainBox.classList.remove("hidden");
    userInfo.innerText="Quyá»n Ä‘ang sá»­ dá»¥ng: "+role.toUpperCase();

    if(role==="view"){
        btnAdd.disabled=btnExport.disabled=btnImport.disabled=true;
        inpViec.disabled=inpGio.disabled=true;
    }
    if(role==="user"){
        btnImport.disabled=true;
    }
    render();
}
if(role) init();

/* ===== RENDER + Cáº¢NH BÃO 6 GIá»œ ===== */
function render(){
    body.innerHTML="";
    const now=new Date();
    let coCanhBao=false;

    data.sort((a,b)=>new Date(a.g)-new Date(b.g));

    data.forEach(i=>{
        const tg=new Date(i.g);
        const diff=(tg-now)/3600000;
        let trangThai="Äang chá»";
        let cls="";

        if(diff<0){
            trangThai="ÄÃ£ qua";
        }else if(diff<=6){
            trangThai="âš ï¸ CÃ²n dÆ°á»›i 6 giá»";
            cls="urgent";
            coCanhBao=true;
        }

        body.innerHTML+=`
        <tr class="${cls}">
            <td>${tg.toLocaleString("vi-VN")}</td>
            <td>${i.v}</td>
            <td>${trangThai}</td>
            <td>${role==="admin"
                ?`<button class="del" onclick="xoa(${i.id})">XÃ³a</button>`
                :""
            }</td>
        </tr>`;
    });

    if(coCanhBao){
        document.getElementById("alertSound").play().catch(()=>{});
    }
    localStorage.setItem("LICH_CT",JSON.stringify(data));
}

/* ===== NGHIá»†P Vá»¤ ===== */
function themLich(){
    if(!inpViec.value||!inpGio.value) return alert("Thiáº¿u thÃ´ng tin");
    data.push({id:Date.now(),v:inpViec.value,g:inpGio.value});
    inpViec.value=""; inpGio.value="";
    render();
}
function xoa(id){
    if(confirm("XÃ³a lá»‹ch nÃ y?")){
        data=data.filter(i=>i.id!==id);
        render();
    }
}
function xuat(){
    const a=document.createElement("a");
    a.href=URL.createObjectURL(new Blob([JSON.stringify(data,null,2)]));
    a.download="backup_lich.json";
    a.click();
}
function nhap(e){
    const r=new FileReader();
    r.onload=ev=>{
        data=JSON.parse(ev.target.result);
        render();
        alert("Phá»¥c há»“i thÃ nh cÃ´ng");
    };
    r.readAsText(e.target.files[0]);
}

/* ===== NGÃ€Y HIá»†N Táº I ===== */
function hienNgayDayDu(){
    const d=new Date();
    const thu=d.toLocaleDateString("vi-VN",{weekday:"long"});
    return `${thu}, ngÃ y ${d.getDate()} thÃ¡ng ${d.getMonth()+1} nÄƒm ${d.getFullYear()}`;
}
document.getElementById("ngayHienTai").innerText=hienNgayDayDu();
setInterval(render,60000);
</script>

</body>
</html>
